package com.devsecops.webapp.demo;

import org.junit.jupiter.api.Test;
import static org.junit.jupiter.api.Assertions.*;
import java.util.*;

/**
 * DEMO TEST CLASS - Shows test coverage and quality issues
 * Tests are designed to pass but show low coverage for SonarQube demo
 */
public class VulnerabilityDemoServiceTest {
    
    private VulnerabilityDemoService demoService = new VulnerabilityDemoService();
    
    @Test
    public void testHashPassword() {
        // Basic test - low coverage
        String result = demoService.hashPassword("test123");
        assertNotNull(result);
        assertEquals(32, result.length()); // MD5 hash length
        // Missing edge cases, null tests, etc.
    }
    
    @Test
    public void testIsValidAge() {
        // Partial coverage
        assertTrue(demoService.isValidAge(25));
        assertFalse(demoService.isValidAge(15));
        assertTrue(demoService.isValidAge(18));
        assertFalse(demoService.isValidAge(121));
        // Missing boundary tests for negative numbers
    }
    
    @Test
    public void testValidateEmail() {
        // Incomplete test
        assertTrue(demoService.validateEmail("test@example.com"));
        assertFalse(demoService.validateEmail("invalid-email"));
        // Missing null tests, ReDoS tests
    }
    
    @Test
    public void testCalculateTotal() {
        List<Integer> numbers = Arrays.asList(1, 2, 3);
        int result = demoService.calculateTotal(numbers);
        assertEquals(6, result);
        
        // Test empty list
        List<Integer> emptyList = Arrays.asList();
        assertEquals(0, demoService.calculateTotal(emptyList));
        
        // Missing null tests that would reveal the bug
        // List<Integer> nullList = null;
        // demoService.calculateTotal(nullList); // Would throw NPE
    }
    
    @Test
    public void testDetermineUserLevel() {
        // Test basic functionality
        String level = demoService.determineUserLevel(150, true, "enterprise", 6, true);
        assertEquals("platinum", level);
        
        String basicLevel = demoService.determineUserLevel(50, false, "basic", 1, false);
        assertEquals("starter", basicLevel);
    }
    
    // CODE SMELL: Commented out test
    /*
    @Test
    public void testGetUserData() {
        // This test is commented out - reduces coverage
        // Should test SQL injection scenarios but would fail due to no DB
    }
    */
    
    /*
    @Test 
    public void testReadFile() {
        // Commented out - would fail due to file system access
        // Missing tests reduce coverage
    }
    */
    
    // Missing tests for:
    // - readFile() method (file system dependent)
    // - processUserData() method (empty method)
    // - getDebugInfo() method (exposes sensitive data)
    // - processQueue() method (infinite loop potential)
    // - getUserData() method (database dependent)
    
    // This results in low test coverage (~40-50%) for SonarQube demo
}
